# 15. Class

## 15-1. ì†Œê°œ

- ê³µí†µëœ ì†ì„±ì´ë‚˜ ê¸°ëŠ¥ì„ ì •ì˜í•œ ì¶”ìƒì ì¸ ê°œë…
- static member: ì¸ìŠ¤í„´ìŠ¤ì—ì„œëŠ” ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ”, í´ë˜ìŠ¤ ìì²´ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- prototype methods: ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì§ì ‘ í™œìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œí¼í‹°

```
Constructor(ES5)/Class(ES6)
   â””â”€â”€ static properties
   â””â”€â”€ static methods
   â””â”€â”€ prototype
        â””â”€â”€ methods (...)
```

[í´ë˜ìŠ¤ - ES5ì™€ì˜ ë¹„êµ ê´€ë ¨ ë¸”ë¡œê·¸ ë§í¬](https://gomugom.github.io/is-class-only-a-syntactic-sugar/)

```js
// ES5.ì„±ì„±ì í•¨ìˆ˜
function Person1(name) {
  this.name = name;
}

// prototype method
Person1.prototype.getName = function () {
  return this.name;
};

// static method
Person1.isPerson = function (obj) {
  return obj instanceof this;
};

const mj1 = new Person1('ë¯¸ì£¼');
console.log(mj1.getName());
console.log(Person1.isPerson(mj1));

// ES6. í´ë˜ìŠ¤
class Person2 {
  constructor(name) {
    this.name = name;
  }

  // prototype method
  getName() {
    return this.name;
  }

  // static method
  static isPerson(obj) {
    return obj instanceof this;
  }
}

const mj2 = new Person2('ë¯¸ì£¼2');
console.log(mj2.getName());
console.log(Person2.isPerson(mj2));
```

## 15-2. ìƒì„¸

#### 1) ì„ ì–¸ë°©ì‹

```js
// í´ë˜ìŠ¤ ë¦¬í„°ëŸ´
class Person1 {}
console.log(Person1.name);

// ê¸°ëª… í´ë˜ìŠ¤ í‘œí˜„ì‹
const Person2 = class Person22 {};
console.log(Person2.name);

// ìµëª… í´ë˜ìŠ¤ í‘œí˜„ì‹
let Person3 = class {};
console.log(Person3.name);
```

#### 2) ê¸°ì¡´ ë°©ì‹ê³¼ì˜ ì°¨ì´ì 

- let, constì™€ ë§ˆì°¬ê°€ì§€ë¡œ TDZê°€ ì¡´ì¬í•˜ë©°, `ë¸”ë¡ìŠ¤ì½”í”„`ì— ê°‡íŒë‹¤.
- hoistingì„ í•˜ì§€ë§Œ í•¨ìˆ˜ ì„ ì–¸ë¬¸ê³¼ ë‹¬ë¦¬ ë³€ìˆ˜ë§Œ hoisting í•˜ì—¬ TDZì— ê±¸ë¦°ë‹¤.
- ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ì´ˆê¸°í™”í•˜ë©´ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```js
if (true) {
  class A {}
  const a = new A(); // ok
  if (true) {
    const b = new A(); // TDZ - ğŸš¨Aë€ ë³€ìˆ˜ë§Œ í˜¸ì´ìŠ¤íŒ…í•˜ê³  í´ë˜ìŠ¤ë€ ê°’ì„ í• ë‹¹í•˜ì§€ ì•ŠìŒ.
    class A {}
  }
}
const c = new A(); // referenceError
```

- class ë‚´ë¶€ëŠ” strict modeê°€ ê°•ì œëœë‹¤.

- class ë‚´ë¶€ì˜ ëª¨ë“  ë©”ì†Œë“œë¥¼ ì—´ê±°í•  ìˆ˜ ì—†ë‹¤. (ì½˜ì†”ì—ì„œ ìƒ‰ìƒì´ íë¦¬ê²Œ í‘œê¸°ë¨)

```js
class A {
  a() {}
  b() {}
  static c() {}
}

for (let p in A.prototype) {
  console.log(p); // undefined
}

A.prototype.d = function () {};

for (let p in A.prototype) {
  console.log(p); // dë§Œ ì§„í•˜ê²Œ ìƒ‰ìƒ í‘œê¸°ë¨
}
```

- constructorë¥¼ ì œì™¸í•œ ëª¨ë“  ë©”ì†Œë“œëŠ”`new` ëª…ë ¹ì–´ë¡œ í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤.
  - ë©”ì†Œë“œì— prototype propertyê°€ ì—†ê¸° ë•Œë¬¸ì—

```js
class A {
  constructor() {}
  a() {}
  static b() {}
}

const a = new A.prototype.constructor();
const b = new A.prototype.a();
const c = new A.prototype.b();

const d = new A();
const e = new d.constructor();
```

- ìƒì„±ì(í•¨ìˆ˜)ë¡œì„œë§Œ ë™ì‘í•œë‹¤.
  - í•¨ìˆ˜/ìƒì„±ì í•¨ìˆ˜ ëª¨ë‘ë¡œ ì“°ì¼ ìˆ˜ ìˆë˜ ê¸°ì¡´ì˜ ë°©ì‹ ë‹¬ë¦¬ classëŠ” ì˜¤ì§ ìƒì„±ì í•¨ìˆ˜ë¡œì„œë§Œ `new`ì—°ì‚°ìì™€ í•¨ê»˜ ë™ì‘!

```js
class A {}
A();
```

- í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ í´ë˜ìŠ¤ëª… ìˆ˜ì •

```js
let A = class {
  constructor() {
    A = 'A';
  }
};
const a = new A();
console.log(A);

const B = class {
  constructor() {
    B = 'B';
  }
};
const b = new B();

// class ì„ ì–¸ë¬¸
class C {
  // í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ í•´ë‹¹ í´ë˜ìŠ¤ëª…ì„ ë°”ê¾¸ë ¤ ì‹œë„í•˜ë©´ ìƒìˆ˜ë¡œì„œ ë™ì‘, ì™¸ë¶€ì—ì„  letìœ¼ë¡œ ì„ ì–¸ëœ ê²ƒìœ¼ë¡œ ë™ì‘
  constructor() {
    C = 'C';
  }
}
const c = new C();
```

- í´ë˜ìŠ¤ ì™¸ë¶€ì—ì„œ í´ë˜ìŠ¤ëª… ìˆ˜ì • ê°€ëŠ¥

```js
let A = class {};
A = 10; // ok

const B = class {};
B = 10; // Uncaught Type Error: Assignment to constant variable

class C {}
C = 10; // ok
```

- ì™¸ë¶€ì—ì„œ prototypeì„ ë‹¤ë¥¸ ê°ì²´ë¡œ ë®ì–´ì”Œìš¸ ìˆ˜ ì—†ë‹¤ (ì½ê¸°-ì „ìš©)
- ì„ ì–¸ê³¼ ë™ì‹œì— ì½ê¸° ì „ìš©ìœ¼ë¡œ ë°”ë€Œì–´ ì™¸ë¶€ì—ì„œ prototype ê°ì²´ ì ‘ê·¼ ë¶ˆê°€(ê°ì²´ ë‚´ prototypeì€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒê³¼ í—·ê°ˆë¦¬ì§€ ë§ ê²ƒ.)

```js
class A {
  a() {}
}

A.prototype = {
  a() {
    console.log(1);
  },
};
const a = new A();
a.a(); // undefined
```

#### 3) 'ë¬¸'ì´ ì•„ë‹Œ 'ì‹(ê°’)'ì´ë‹¤.

- ê°’ìœ¼ë¡œ ë„˜ê²¨ í™œìš©í•  ìˆ˜ ìˆë‹¤.

```js
const mj = new (class {
  constructor(name) {
    this.name = name;
  }
  sayName() {
    console.log(this.name);
  }
})('ë¯¸ì£¼');

mj.sayName();
```

```js
const instanceGenerator = (className, ...params) => new className(...params);

class Person {
  constructor(name) {
    this.name = name;
  }
  sayName() {
    console.log(this.name);
  }
}

const mj = instanceGenerator(Person, 'ë¯¸ì£¼');
const ty = instanceGenerator(
  class {
    constructor(name) {
      this.name = name;
    }
    sayName() {
      console.log(this.name);
    }
  },
  'íƒœìœ¤'
);

mj.sayName();
ty.sayName();
```

#### 4) ì ‘ê·¼ì

```js
class CustomHTMLElement {
  constructor(element) {
    this._element = element;
  }
  get html() {
    return this._element.innerHTML;
  }
  set html(value) {
    this._element.innerHTML = value;
  }
}
console.log(Object.entries(CustomHTMLElement.prototype));
console.log(Object.getOwnPropertyDescriptor(CustomHTMLElement.prototype, 'html'));
```

#### 5) computed property names

```js
const method1 = 'sayName';
const fullNameGetter = 'fullname';

class Person {
  constructor(name) {
    this.name = name;
  }
  [method1]() {
    console.log(this.name);
  }
  get [fullNameGetter]() {
    return this.name + ' ë°•';
  }
}
const mj = new Person('ë¯¸ì£¼');
mj.sayName();
console.log(mj.fullname); // ë¯¸ì£¼ ë°•
```

#### 6) ì œë„ˆë ˆì´í„°

```js
const gen = function* () {
  yield 1;
  yield 2;
};

const g = gen();
g.next(); // { value: 1, done: folse }
g.next(); // { value: 2, done: false }
g.next(); // { value: undefined, done: true }

const obj = {
  *generator() {},
};
```

```js
class A {
  *generator() {
    yield 1;
    yield 2;
  }
}
const a = new A();
const iter = a.generator();
console.log(...iter);
```

#### 7) Symbol.iterator

```js
class Products {
  constructor() {
    this.items = new Set();
  }
  addItem(name) {
    this.items.add(name);
  }
  [Symbol.iterator]() {
    let count = 0;
    const items = [...this.items];
    return {
      next() {
        return {
          done: count >= items.length,
          value: items[count++],
        };
      },
    };
  }
}
const prods = new Products();
prods.addItem('ì‚¬ê³¼');
prods.addItem('ë°°');
prods.addItem('í¬ë„');

console.log([...prods]); // ["ì‚¬ê³¼", "ë°°", "í¬ë„"]

for (let x of prods) {
  console.log(x);
}

const iter = a[Symbol.iterator]();
iter.next(); // {done: false, value: "ì‚¬ê³¼"}
iter.next(); // {done: false, value: "ë°°"}
iter.next(); // {done: false, value: "í¬ë„"}
iter.next(); // {done: true, value: undefined}
```

```js
class Products {
  constructor() {
    this.items = new Set();
  }
  addItem(name) {
    this.items.add(name);
  }
  *[Symbol.iterator]() {
    yield* this.items;
  }
}
const prods = new Products();
prods.addItem('ì‚¬ê³¼');
prods.addItem('ë°°');
prods.addItem('í¬ë„');

for (let x of prods) {
  console.log(x);
}

const iter = a[Symbol.iterator]();
iter.next(); // {done: false, value: "ì‚¬ê³¼"}
iter.next(); // {done: false, value: "ë°°"}
iter.next(); // {done: false, value: "í¬ë„"}
iter.next(); // {done: true, value: undefined}
```

### 8) ì •ì  ë©”ì†Œë“œ (static method)

- í´ë˜ìŠ¤ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥, ì¸ìŠ¤í„´ìŠ¤ì—ì„  ì§ì ‘ì ìœ¼ë¡œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥
- ì¸ìŠ¤í„´ìŠ¤ê°€ thisì¼ ë• ì ‘ê·¼ ë¶ˆê°€ëŠ¥

```js
class Person {
  static create(name) {
    return new this(name); // this === Person
  }
  constructor(name) {
    this.name = name;
  }
}
const mj = Person.create('ë¯¸ì£¼');
console.log(mj);
console.log(mj.__proto__.constructor.create());
// mj.__proto__.constructor === Person === this
```

## 15-3. í´ë˜ìŠ¤ ìƒì†

### 15-3-1. ì†Œê°œ

```js
function Square(width) {
  this.width = width;
}

Square.prototype.getArea = function () {
  return this.width * (this.height || this.width);
};

function Rectangle(width, height) {
  Square.call(this, width);
  this.height = height;
}

function B() {}

B.prototype = Square.prototype;
Rectangle.prototype = new B();
Rectangle.prototype.constructor = Rectangle;

const square = Square(3);
const rect = new Rectangle(3, 4);

console.log(rect.getArea());
console.log(rect instanceof Rectangle); // true
console.log(rect instanceof Square); // true
console.log(rect instanceof Object); // true
```

```js
class Square {
  constructor(width) {
    this.width = width;
  }
  getArea() {
    return this.width * (this.height || this.width);
  }
}

class Rectangle extends Square {
  constructor(width, height) {
    super(width);
    this.height = height;
  }
}

const rect = new Rectangle(3, 4);
console.log(rect.getArea());
console.log(rect instanceof Rectangle);
console.log(rect instanceof Square);
```

### 15-3-2. ìƒì„¸

1. `class [ì„œë¸Œí´ë˜ìŠ¤ëª…] extends [ìˆ˜í¼í´ë˜ìŠ¤ëª…] { [ì„œë¸Œí´ë˜ìŠ¤ ë³¸ë¬¸] }`

- ë°˜ë“œì‹œ ë³€ìˆ˜ë§Œ ì™€ì•¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í´ë˜ìŠ¤ ì‹ì´ ì™€ë„ ëœë‹¤.

```js
class Employee extends class Person {
  constructor(name) {
    this.name = name;
  }
} {
  constructor(name, position) {
    super(name);
    this.position = position;
  }
}
const mj = new Employee('ë¯¸ì£¼', 'worker');
```

```js
class Employee extends class {
  constructor(name) {
    this.name = name;
  }
} {
  constructor(name, position) {
    super(name);
    this.position = position;
  }
}
const mj = new Employee('ë¯¸ì£¼', 'worker');
console.log(mj.__proto__.__proto__.constructor.name);
```

- í•¨ìˆ˜ë„ ìƒì† ê°€ëŠ¥.

```js
function Person(name) {
  this.name = name;
}
class Employee extends Person {
  constructor(name, position) {
    super(name);
    this.position = position;
  }
}
const mj = new Employee('ë¯¸ì£¼', 'worker');
```

```js
class Employee extends function (name) {
  this.name = name;
} {
  constructor(name, position) {
    super(name);
    this.position = position;
  }
}
const mj = new Employee('ë¯¸ì£¼', 'worker');
```

- ë‚´ì¥ íƒ€ì… ìƒì† ê°€ëŠ¥

```js
class NewArray extends Array {
  toString() {
    return `[${super.toString()}]`;
  }
}
const arr = new NewArray(1, 2, 3);
console.log(arr);
console.log(arr.toString());
```

2. super (ë‚´ë¶€í‚¤ì›Œë“œë¡œì¨, í—ˆìš©ëœ ë™ì‘ ì™¸ì—” í™œìš© ë¶ˆê°€)

- (1) constructor ë‚´ë¶€ì—ì„œ

  - ìˆ˜í¼í´ë˜ìŠ¤ì˜ constructorë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ ê°œë….
  - (ê·œì¹™)ì„œë¸Œí´ë˜ìŠ¤ì˜ constructor ë‚´ë¶€ì—ì„œ `this`ì— ì ‘ê·¼í•˜ë ¤ í•  ë•ŒëŠ” **ê°€ì¥ ë¨¼ì €** superí•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ë§Œ í•œë‹¤.
  - ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ constructorë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¬´ê´€. (ì´ ê²½ìš° ìƒìœ„í´ë˜ìŠ¤ì˜ constructorë§Œ ì‹¤í–‰ëœë‹¤.)ê±°ë‚˜, ë‚´ë¶€ì—ì„œ `this`ì— ì ‘ê·¼í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¬´ê´€.

- (2) ë©”ì†Œë“œ ë‚´ë¶€ì—ì„œ
  - ìˆ˜í¼í´ë˜ìŠ¤ì˜ í”„ë¡œí† íƒ€ì… ê°ì²´ ê°œë….
  - ë©”ì†Œë“œ ì˜¤ë²„ë¼ì´ë“œ ë˜ëŠ” ìƒìœ„ ë©”ì†Œë“œ í˜¸ì¶œ ëª©ì ìœ¼ë¡œ í™œìš©.
  - `super`ì— ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€ëŠ¥.

```js
class Rectangle {
  constructor (width, height) {
    this.width = width
    this.height = height
  }
  getArea () {
    return this.width * this.height
  }
}
class Square extends Rectangle {
  constructor (width) {
    console.log(super)
    super(width, width) // Error
  }
  getArea () {
    console.log('get area of square.')
    console.dir(super)
    return super.getArea()
  }
}
const square = new Square(3)
console.log(square.getArea())
```

3. `new.target`ì„ í™œìš©í•œ abstract class í‰ë‚´

```js
class Shape {
  constructor() {
    if (new.target === Shape) {
      throw new Error('ì´ í´ë˜ìŠ¤ëŠ” ì§ì ‘ ì¸ìŠ¤í„´ìŠ¤í™”í•  ìˆ˜ ì—†ëŠ” ì¶”ìƒí´ë˜ìŠ¤ì…ë‹ˆë‹¤.');
    }
  }
  getSize() {}
}

class Rectangle extends Shape {
  constructor(width, height) {
    super();
    this.width = width;
    this.height = height;
  }

  getSize() {
    return this.width * this.height;
  }
}
const s = new Shape();
const r = new Rectangle(4, 5);
```

```js
Employee.prototype = new Person();
Employee.prototype.constructor = Employee;

function Bridge() {}
Bridge.prototype = Person.prototype;
Employee.prototype = new Bridge();
Employee.prototype.constructor = Employee;
```

```js
var extendClass = (function() {
  function Bridge() {} # í•© ë²ˆë§Œ ë§Œë“¤ê³  ê·¸ëŒ€ë¡œ ì¬í™œìš©
  return function(Parent, Child) {
    Bridge.prototype = Parent.prototype
    Child.prototype = new Bride();
    Child.prototype.constructor = Child
    Child.prototype.superClass = Parent
  }
})()
```
